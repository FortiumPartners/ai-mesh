{
  "dashboard": {
    "id": "tenant-monitoring",
    "title": "Tenant-Specific Monitoring - Multi-Tenant Observability",
    "description": "Comprehensive tenant isolation dashboard with resource usage tracking, performance monitoring, and SLA compliance",
    "tags": ["tenant", "multi-tenant", "isolation", "sla", "resource-usage"],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "30s",
    "schemaVersion": 1,
    "version": 1,
    "panels": [
      {
        "id": 1,
        "title": "Active Tenants Overview",
        "type": "stat",
        "targets": [
          {
            "expr": "count(count by (tenant_id) (business_metrics_tenant_activity{service_name=\"fortium-monitoring-service\"} > 0))",
            "legendFormat": "Active Tenants",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "steps": [
                {
                  "color": "green",
                  "value": 0
                },
                {
                  "color": "yellow",
                  "value": 50
                },
                {
                  "color": "red",
                  "value": 100
                }
              ]
            }
          }
        },
        "gridPos": {
          "h": 8,
          "w": 6,
          "x": 0,
          "y": 0
        }
      },
      {
        "id": 2,
        "title": "Tenant Request Rate Distribution",
        "type": "graph",
        "targets": [
          {
            "expr": "topk(10, sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}}",
            "refId": "A"
          }
        ],
        "yAxes": [
          {
            "label": "Requests per second",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 9,
          "x": 6,
          "y": 0
        }
      },
      {
        "id": 3,
        "title": "Tenant SLA Compliance",
        "type": "table",
        "targets": [
          {
            "expr": "avg_over_time(histogram_quantile(0.95, sum(rate(http_request_duration_milliseconds_bucket{service_name=\"fortium-monitoring-service\"}[5m])) by (le, tenant_id))[5m:1m])",
            "legendFormat": "P95 Latency - {{tenant_id}}",
            "refId": "A",
            "format": "table"
          },
          {
            "expr": "avg_over_time((sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\",status_code=~\"4..|5..\"}[5m])) by (tenant_id) / sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id) * 100)[5m:1m])",
            "legendFormat": "Error Rate % - {{tenant_id}}",
            "refId": "B",
            "format": "table"
          },
          {
            "expr": "(1 - (sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\",status_code=~\"5..\"}[5m])) by (tenant_id) / sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id))) * 100",
            "legendFormat": "Availability % - {{tenant_id}}",
            "refId": "C",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "merge",
            "options": {}
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "P95 Latency"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "ms"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "green",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 200
                      },
                      {
                        "color": "red",
                        "value": 500
                      }
                    ]
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Error Rate %"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "green",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 1
                      },
                      {
                        "color": "red",
                        "value": 5
                      }
                    ]
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Availability %"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "red",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 99
                      },
                      {
                        "color": "green",
                        "value": 99.9
                      }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 9,
          "x": 15,
          "y": 0
        }
      },
      {
        "id": 4,
        "title": "Tenant Resource Usage - CPU Time",
        "type": "graph",
        "targets": [
          {
            "expr": "topk(10, sum(rate(business_metrics_cpu_usage_milliseconds{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}}",
            "refId": "A"
          }
        ],
        "yAxes": [
          {
            "label": "CPU milliseconds per second",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 8
        }
      },
      {
        "id": 5,
        "title": "Tenant Resource Usage - Memory",
        "type": "graph",
        "targets": [
          {
            "expr": "topk(10, avg(business_metrics_memory_usage_bytes{service_name=\"fortium-monitoring-service\"}) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}}",
            "refId": "A"
          }
        ],
        "yAxes": [
          {
            "label": "Memory usage (bytes)",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 8
        }
      },
      {
        "id": 6,
        "title": "Tenant API Rate Limiting Status",
        "type": "table",
        "targets": [
          {
            "expr": "sum(rate(business_metrics_rate_limit_hits_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id)",
            "legendFormat": "Rate Limit Hits - {{tenant_id}}",
            "refId": "A",
            "format": "table"
          },
          {
            "expr": "sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id)",
            "legendFormat": "Total Requests - {{tenant_id}}",
            "refId": "B",
            "format": "table"
          },
          {
            "expr": "sum(rate(business_metrics_rate_limit_hits_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id) / sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id) * 100",
            "legendFormat": "Rate Limit % - {{tenant_id}}",
            "refId": "C",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "merge",
            "options": {}
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Rate Limit Hits"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "reqps"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Total Requests"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "reqps"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Rate Limit %"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "green",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 5
                      },
                      {
                        "color": "red",
                        "value": 15
                      }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 16
        }
      },
      {
        "id": 7,
        "title": "Tenant Storage Consumption",
        "type": "graph",
        "targets": [
          {
            "expr": "topk(10, sum(business_metrics_storage_usage_bytes{service_name=\"fortium-monitoring-service\"}) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}}",
            "refId": "A"
          }
        ],
        "yAxes": [
          {
            "label": "Storage usage (bytes)",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 16
        }
      },
      {
        "id": 8,
        "title": "Tenant Activity Patterns",
        "type": "heatmap",
        "targets": [
          {
            "expr": "sum(rate(business_metrics_tenant_activity{service_name=\"fortium-monitoring-service\"}[5m])) by (tenant_id)",
            "legendFormat": "{{tenant_id}}",
            "refId": "A"
          }
        ],
        "heatmap": {
          "yAxis": {
            "unit": "short",
            "decimals": 0
          },
          "xAxis": {
            "show": true
          }
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 24
        }
      },
      {
        "id": 9,
        "title": "Tenant Onboarding Metrics",
        "type": "graph",
        "targets": [
          {
            "expr": "sum(rate(business_metrics_tenant_onboarding_total{service_name=\"fortium-monitoring-service\"}[5m]))",
            "legendFormat": "New Tenants/sec",
            "refId": "A"
          },
          {
            "expr": "sum(rate(business_metrics_tenant_activation_total{service_name=\"fortium-monitoring-service\"}[5m]))",
            "legendFormat": "Tenant Activations/sec",
            "refId": "B"
          },
          {
            "expr": "sum(rate(business_metrics_tenant_churn_total{service_name=\"fortium-monitoring-service\"}[5m]))",
            "legendFormat": "Tenant Churn/sec",
            "refId": "C"
          }
        ],
        "yAxes": [
          {
            "label": "Events per second",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 24
        }
      },
      {
        "id": 10,
        "title": "Tenant-Specific Error Analysis",
        "type": "table",
        "targets": [
          {
            "expr": "topk(10, sum(rate(http_requests_total{service_name=\"fortium-monitoring-service\",status_code=~\"4..\"}[5m])) by (tenant_id, status_code))",
            "legendFormat": "{{tenant_id}} - {{status_code}}",
            "refId": "A",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "tenant_id": "Tenant ID",
                "status_code": "Status Code",
                "Value": "Errors/sec"
              }
            }
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Errors/sec"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "reqps"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "green",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 0.1
                      },
                      {
                        "color": "red",
                        "value": 1
                      }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 32
        }
      },
      {
        "id": 11,
        "title": "Tenant SLA Breach Detection",
        "type": "logs",
        "targets": [
          {
            "expr": "ALERTS{alertname=~\".*TenantSLA.*\", service=\"fortium-monitoring-service\"}",
            "legendFormat": "SLA Breach: {{tenant_id}}",
            "refId": "A"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 32
        }
      },
      {
        "id": 12,
        "title": "Tenant Bandwidth Usage",
        "type": "graph",
        "targets": [
          {
            "expr": "topk(10, sum(rate(business_metrics_bandwidth_bytes{service_name=\"fortium-monitoring-service\",direction=\"in\"}[5m])) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}} - Inbound",
            "refId": "A"
          },
          {
            "expr": "topk(10, sum(rate(business_metrics_bandwidth_bytes{service_name=\"fortium-monitoring-service\",direction=\"out\"}[5m])) by (tenant_id))",
            "legendFormat": "Tenant {{tenant_id}} - Outbound",
            "refId": "B"
          }
        ],
        "yAxes": [
          {
            "label": "Bytes per second",
            "min": 0
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 40
        }
      },
      {
        "id": 13,
        "title": "Tenant Feature Usage Distribution",
        "type": "piechart",
        "targets": [
          {
            "expr": "sum(rate(business_metrics_feature_usage_total{service_name=\"fortium-monitoring-service\",tenant_id=\"$tenant\"}[5m])) by (feature_name)",
            "legendFormat": "{{feature_name}}",
            "refId": "A"
          }
        ],
        "options": {
          "pieType": "donut",
          "displayLabels": ["name", "percent"]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 40
        }
      },
      {
        "id": 14,
        "title": "Resource Quota Utilization by Tenant",
        "type": "table",
        "targets": [
          {
            "expr": "business_metrics_cpu_usage_milliseconds{service_name=\"fortium-monitoring-service\"} / business_metrics_cpu_quota_milliseconds{service_name=\"fortium-monitoring-service\"} * 100",
            "legendFormat": "CPU Quota % - {{tenant_id}}",
            "refId": "A",
            "format": "table"
          },
          {
            "expr": "business_metrics_memory_usage_bytes{service_name=\"fortium-monitoring-service\"} / business_metrics_memory_quota_bytes{service_name=\"fortium-monitoring-service\"} * 100",
            "legendFormat": "Memory Quota % - {{tenant_id}}",
            "refId": "B",
            "format": "table"
          },
          {
            "expr": "business_metrics_storage_usage_bytes{service_name=\"fortium-monitoring-service\"} / business_metrics_storage_quota_bytes{service_name=\"fortium-monitoring-service\"} * 100",
            "legendFormat": "Storage Quota % - {{tenant_id}}",
            "refId": "C",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "merge",
            "options": {}
          }
        ],
        "fieldConfig": {
          "overrides": [
            {
              "matcher": {
                "id": "byRegexp",
                "options": ".*Quota.*"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percent"
                },
                {
                  "id": "thresholds",
                  "value": {
                    "steps": [
                      {
                        "color": "green",
                        "value": 0
                      },
                      {
                        "color": "yellow",
                        "value": 70
                      },
                      {
                        "color": "red",
                        "value": 90
                      }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 48
        }
      }
    ],
    "templating": {
      "list": [
        {
          "name": "tenant",
          "type": "query",
          "query": "label_values(business_metrics_tenant_activity{service_name=\"fortium-monitoring-service\"}, tenant_id)",
          "current": {
            "value": "All",
            "text": "All"
          },
          "includeAll": true
        },
        {
          "name": "time_range",
          "type": "interval",
          "options": [
            {
              "text": "5m",
              "value": "5m",
              "selected": false
            },
            {
              "text": "15m",
              "value": "15m",
              "selected": false
            },
            {
              "text": "1h",
              "value": "1h",
              "selected": true
            },
            {
              "text": "6h",
              "value": "6h",
              "selected": false
            },
            {
              "text": "24h",
              "value": "24h",
              "selected": false
            }
          ]
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "name": "SLA Breaches",
          "datasource": "SignOz",
          "expr": "ALERTS{alertname=~\".*TenantSLA.*\", service=\"fortium-monitoring-service\"}",
          "iconColor": "red",
          "textFormat": "SLA breach: {{tenant_id}} - {{alertname}}"
        },
        {
          "name": "Tenant Onboarding",
          "datasource": "SignOz",
          "expr": "business_metrics_tenant_onboarding_total{service_name=\"fortium-monitoring-service\"}",
          "iconColor": "green",
          "textFormat": "New tenant onboarded: {{tenant_id}}"
        },
        {
          "name": "Resource Quota Exceeded",
          "datasource": "SignOz",
          "expr": "business_metrics_cpu_usage_milliseconds{service_name=\"fortium-monitoring-service\"} / business_metrics_cpu_quota_milliseconds{service_name=\"fortium-monitoring-service\"} > 0.9",
          "iconColor": "orange",
          "textFormat": "Resource quota >90%: {{tenant_id}}"
        }
      ]
    }
  }
}